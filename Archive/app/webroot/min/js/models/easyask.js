!function(){define(["utilities/global","controllers/application","models/api"],function(){var a=window.LSP.utilities,b=window.LSP.models;a.register("model","easyask",function(){var c,d=$.extend({},b.api),e="nslonestarpercussion",f="http://lonestarpercussion.prod.easyaskondemand.com",g={};return $.extend(d,{_timeout:3e4,_url:function(){return f+"/EasyAsk/apps/Advisor.jsp"},_payload:function(b,c){var f={RequestAction:c.action,RequestData:c.method,currentpage:c.page||1,forcepage:1,ResultsPerPage:c.resultsPerPage||24,defsortcols:"default"===c.sort?"":c.sort,indexed:1,rootprods:1,oneshot:1,defarrangeby:"///NONE///",disp:"json",dct:e,q:c.keywords&&c.keywords.length?c.keywords:void 0,AttribSel:d.combineSimilarAttributesForRequest(c.attribute,c.allAttributes)};return f.CatPath=a.cleanArray([(c.category||"").replace("All Products",""),d.combineAndRemoveAllForPath(c.attribute,c.allAttributes),this.buildKeywordString(c.keywords)]).join("/").replace(/^\/{1,}-/,"-"),$.isEmptyObject(c.allAttributes)&&!c.attribute&&"CA_AttributeSelected"===c.method&&(f.RequestData="CA_BreadcrumbClick"),"CA_BreadcrumbRemove"!==f.RequestData||f.q||f.AttribSel||(f.RequestData="CA_CategoryExpand"),"CA_Search"!==f.RequestData&&delete f.q,(f.ResultsPerPage>96||"all"===(f.ResultsPerPage+""||"").toLowerCase())&&(f.ResultsPerPage=96),f.CatPath=f.CatPath.replace(/\/$/,"").replace(/^\//,"").replace(/\/\//g,"/"),f},_isSuccess:function(a){return 0===(a||{}).returnCode},isRedirect:function(a){return/((http|https)(:\/\/))?([a-zA-Z0-9]+[.]{1}){2}[a-zA-z0-9]+(\/{1}[a-zA-Z0-9]+)*\/?/.test(a.errorMsg)||/^\//.test(a.errorMsg)},_afterSuccess:function(a){if(d.isRedirect(a))return void(document.location=a.errorMsg);c=a.sessionID,a.source=d.clean(a.source),a.source.navPath._lsp=a.source.navPath._lsp||{},a.source.navPath._lsp.categoryNodes=d.getCategoryNodes(a.source),a.source.navPath._lsp.refinementNodes=d.getRefinementNodes(a.source),a.source.navPath._lsp.searchNode=d.getSearchNode(a.source),this.cacheAttributes(a.source),a.source.attributes=a.source.attributes||{},a.source.attributes._lsp=a.source.attributes._lsp||{},a.source.attributes._lsp.cached=d.injectCachedAttributes(a.source),a.source._lsp=a.source._lsp||{},a.source._lsp.query=d.parseCommentaryForDidYouMean(a.source.commentary);for(var b=0;b<((a.source.products||{}).items||{}).length;b++)if(a.source.products.items[b].Matrix_Values){var e=$.parseJSON(a.source.products.items[b].Matrix_Values);a.source.products.items[b]._formattedMatrixObject=d.parseMatrixChildren(e)}return a},clean:function(a){for(var b=0;b<((a.categories||{}).categoryList||[]).length;b++)"Schools"===a.categories.categoryList[b].name&&(a.categories.categoryList.splice(b,1),b--);for(var c,b=0;b<((a.attributes||{}).attribute||{}).length;b++){for(var d=0;d<(a.attributes.attribute[b].attributeValueList||{}).length;d++)c=a.attributes.attribute[b].attributeValueList[d].attributeValue,("!"===c.substr(0,1)||"None"===c||"Unknown"===c||"Required"===c)&&(a.attributes.attribute[b].attributeValueList.splice(d,1),d--);for(var d=0;d<(a.attributes.attribute[b].initialAttributeValueList||{}).length;d++)c=a.attributes.attribute[b].initialAttributeValueList[d].attributeValue,("!"===c.substr(0,1)||"None"===c||"Unknown"===c||"Required"===c)&&(a.attributes.attribute[b].initialAttributeValueList.splice(d,1),a.attributes.attribute[b].initDispLimit--,d--);0===a.attributes.attribute[b].attributeValueList.length&&(a.attributes.attribute.splice(b,1),b--)}return 0===((a.attributes||{}).attribute||[]).length&&delete a.attributes,a},combineAndRemoveAllForPath:function(a,b){if(b&&a){var c=a.replace(/:.*/,"");b=b.split("/");for(var d=0;d<b.length;d++)b[d].replace(/:.*/,"")===c&&(b.splice(d,1),d--);return b.join("/")}return b},combineSimilarAttributesForRequest:function(a,b){if(b&&a){var c=a.replace(/:.*/,"");b=b.split("/");for(var d=0;d<b.length;d++)b[d].replace(/:.*/,"")===c&&(a+=";"+b[d]);return a}return a},buildKeywordString:function(a){return a?("-"+a).replace(/-{1,}/,"-"):null},buildSingleAttributeString:function(a){return this.buildMultiAttributeString(a).replace("AttribSelect=","").replace(/\/\/\/\/*/,"")},clearCachedAttributes:function(){g={}},cacheAttributes:function(a){var b={};$.each(g,function(a,b){g[b.attribute.name].isFromCached=!0});for(var c=0;c<((a.attributes||{}).attribute||{}).length;c++){var d=a.attributes.attribute[c];g[d.name]={index:c,attribute:d,isFromCached:!1},b[d.name]=!0}return $.each(g,function(c,d){var e=$(a.navPath.navPathNodeList).last()[0].seoPath,f=d.attribute.attributeValueList[0].nodeString.replace(/:.*/,"");!b[d.attribute.name]&&e.indexOf(f+":")<0&&delete g[d.attribute.name]}),b},injectCachedAttributes:function(a){var b=[],c=[];return $.each(g,function(a,b){c.push(b)}),c.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:a.isFromCached&&!b.isFromCached?-1:b.isFromCached&&!a.isFromCached?1:0}),$.each(c,function(c,d){for(var e=!1,f=0;f<((a.attributes||{}).attribute||{}).length;f++)a.attributes.attribute[f].attributeName===d.attribute.name&&(e=!0,b.push(a.attributes.attribute[f]));e||b.push(d.attribute)}),this.markSelectedAttributes(a,b)},markSelectedAttributes:function(a,b){var b=$.extend(!0,[],b);return $.each(((a.navPath||{})._lsp||{}).refinementNodes,function(a,c){for(var d=0;d<(b||{}).length;d++)if((b[d]||{}).name===c.attribute){for(var a=0;a<(b[d].attributeValueList||{}).length;a++)if(c.value===b[d].attributeValueList[a].attributeValue){b[d].attributeValueList[a].selected=!0;break}break}}),b},getCategoryNodes:function(a){for(var b=[],c=a.navPath.navPathNodeList,d=this.getCategoriesFromSEOPath(c[c.length-1].seoPath),e=0;e<a.navPath.navPathNodeList.length;e++)if(1===c[e].navNodePathType&&(c[e].englishName=c[e].englishName.replace(/\/$/,""),c[e].englishName="All-Products"===c[e].englishName?"All Products":c[e].englishName,"All Products"!==c[e].englishName&&"School"!==c[e].englishName)){var f=b.push(c[e]),g=b[f-1].seoPath;b[f-1].removePath=d.substr(d.indexOf(g)+g.length,d.length)}return b},getSearchNode:function(a){for(var b=0;b<a.navPath.navPathNodeList.length;b++)if(3===a.navPath.navPathNodeList[b].navNodePathType)return a.navPath.navPathNodeList[b]},getRefinementNodes:function(b){for(var c=[],d=0;d<b.navPath.navPathNodeList.length;d++){var e=b.navPath.navPathNodeList[d];if(2===e.navNodePathType){var f=(decodeURIComponent(b.navPath.fullPath).replace(/\+/g," "),e.englishName.substring(1,e.englishName.length-2));f=f.split("'); (");for(var g=0;g<f.length;g++)for(var h=f[g].split("' or "),i=0;i<h.length;i++){var j=h[i].split(" = '"),k=this.convertToSEOString(j[0]+":"+j[1]),l=a.findBetween(k,";",e.seoPath);c.push({attribute:j[0],value:j[1],nodeString:k+l})}}}return c},parseMatrixChildren:function(a){for(var b={},c={},a=("string"==typeof a?$.parseJSON(a):a)||[],d=0;d<a.length;d++){var e=a[d][0],f=a[d][1].split("|"),g=f[0],h=f[1],i=(f[2],f[3]),j=f[4],k=f[5],l=f[6],m=f[7];waysToSave=f[8],specialFeature=f[9],b[g]=b[g]||{},b[g][h]=b[g][h]||[],b[g][h].push(e),c[e]=c[e]||{},c[e].options=c[e].options||{},c[e].options[g]=c[e].options[g]||{},c[e].options[g]=h,c[e].data=c[e].data||{},c[e].data.imageUrl=i,c[e].data.mpn=j,c[e].data.onlinePrice=k,c[e].data.msrp=l,c[e].data.stockMessage=m,c[e].data.waysToSave=waysToSave,c[e].data.specialFeature=specialFeature}return{options:b,products:c}},filterMatrixChildren:function(a,b){var c={},d={};return $.each(a.products,function(a,c){for(var e in b)if(b.hasOwnProperty(e)&&c.options[e]&&c.options[e]!=b[e])return;d[a]=c}),$.each(d,function(a,d){$.each(d.options,function(d,e){b[d]||(c[d]=c[d]||{},c[d][e]=c[d][e]||[],c[d][e].push(a))})}),c},convertToSEOString:function(a){return a.replace(/'/g,"").replace(/[^A-Za-z0-9:]/g,"-").replace(/-{1,}/g,"-").replace(/-$/,"").replace(/:-/,":")},getCategoriesFromSEOPath:function(a){for(var a=a.split("/"),b=0;b<a.length;b++)(a[b].indexOf(":")>0||0===a[b].indexOf("-"))&&(a.splice(b,1),b--);return a.join("/")},getRefinementsFromSEOPath:function(a){for(var a=a.split("/"),b=0;b<a.length;b++)(a[b].indexOf(":")<0||0===a[b].indexOf("-"))&&(a.splice(b,1),b--);return a.join("/")},getKeywordsFromSEOPath:function(a){for(var a=unescape(a).split("/"),b=0;b<a.length;b++)if(0===a[b].indexOf("-"))return encodeURIComponent(a[b]);return""},parseCommentaryForDidYouMean:function(b){var c={};if(b.length>0&&b.indexOf("Corrected Word")>-1){{b.split(" ")}c.originalQuery=a.findBetween("Corrected Word: "," is ",b),c.assumedQuery=a.findBetween(" is ","; ",b),c.otherSuggestions=(a.findBetween(" could be  ","~END",b+"~END")||"").split(", ")}return c}})}())})}();