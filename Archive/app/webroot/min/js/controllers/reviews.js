!function(){define(["utilities/global","controllers/application","vendors/form2js/form2js","models/api","models/netsuite"],function(){var a=window.LSP.utilities;a.register("controller","reviews",function(){var b={},c=window.LSP,d=c.models.netsuite,e={containerSelector:"#addReviewForm",formSelector:"#reviews-inputForm",prosInputSelector:"#reviews-inputForm .pros input",consInputSelector:"#reviews-inputForm .cons input",reviewTemplateId:"templates-reviewEntry",previewSelector:"#previewReview"};return b={name:"reviews",events:{reviews:{onAfterAPICallSuccess:function(){$(e.formSelector).removeClass("loading"),$("#reviewEntries").removeClass("loading secondary"),$('button.b1.reveal-open[data-reveal-children*="addReviewForm"]').trigger("click"),$(":input",e.formSelector).removeAttr("disabled")},onBeforeAPICall:function(){$(e.formSelector).addClass("loading"),$("#reviewEntries").addClass("loading secondary"),$(":input",e.formSelector).attr("disabled")},onSave:function(a,d){var e=d.selector[0];c.controllers.validation.validateForm(e)&&b.save(b.parseForm(e))},onProOrConInput:function(a){a.currentTarget.value.length>0?$(a.currentTarget).parent().next().show():$(a.currentTarget).parent().next().length&&($(a.currentTarget).parent().next().children("input").val()||"").length<1?$(a.currentTarget).parent().next().hide():!$(a.currentTarget).is(":focus")&&!$(a.currentTarget).parent().is(":nth-of-type(1)")&&$(a.currentTarget).parent().prev().children().val().length<1&&$(a.currentTarget).parent().hide()},onRenderPreview:function(a){$(e.previewSelector).html(b.render(b.parseForm(a.currentTarget.form)))}},application:{onAttachEvents:function(a,c){$(e.formSelector+" :input",c.selector).off("reviews").on("keyup.lsp.reviews change.lsp.reviews",b.events.reviews.onRenderPreview).filter('input[type="checkbox"], input[type="radio"], select').on("click.lsp.reviews change.lsp.reviews",b.events.reviews.onRenderPreview),$(e.prosInputSelector+", "+e.consInputSelector,c.selector).off("reviews").on("keyup.lsp.reviews change.lsp.reviews",b.events.reviews.onProOrConInput)}}},assets:{},save:function(a){return _gaq.push(["_trackEvent","reviews","saveReview"]),d.request(b,"saveReview",{method:"saveReview",data:JSON.stringify(a)}).done(function(){b.renderSavedReview(a)})},render:function(b){var c=a.parseMicroTemplate(e.reviewTemplateId,b);return c},renderSavedReview:function(){a.scrollTo($(".reviews.section")),$("ul.entries").addClass("saved")},parseForm:function(b){var c,d=[];c=a.formToObject(b,null,!0);for(var e=0;e<((c||{}).custrecordreviewprofile||{}).length;e++)if(c.custrecordreviewprofile[e].title){var f="";if(c.custrecordreviewprofile[e].time>0){var g=c.custrecordreviewprofile[e].time>1?"s":"";f="&nbsp;("+c.custrecordreviewprofile[e].time+"&nbsp;yr"+g+")"}d.push(c.custrecordreviewprofile[e].title+f)}return c.profile=d.join(", "),c}}}())})}();